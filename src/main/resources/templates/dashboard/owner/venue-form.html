<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Crear Complejo deportivo</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>

    <style>
        .card { border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); }
        .required::after { content: " *"; color: #d00; }
    </style>
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card p-4">
                <h3 class="mb-3">Nuevo Complejo Deportivo</h3>

                <!-- Flash / errors / warnings -->
                <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
                <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
                <div th:if="${warning}" class="alert alert-warning" th:text="${warning}"></div>

                <form th:action="@{/dashboard/owner/venues}" th:object="${venue}" method="post" id="venueForm" novalidate>
                    <input type="hidden" th:field="*{ownerId}" th:value="${ownerId}" />
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                    <div class="mb-3">
                        <label class="form-label required">Nombre del complejo</label>
                        <input type="text" class="form-control" th:field="*{name}" placeholder="Ej. Complejo Lugo Sports" required/>
                        <div class="form-text text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Dirección</label>
                        <input type="text" class="form-control" th:field="*{address}" placeholder="Calle 123 #45-67"/>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Zona horaria</label>
                            <input type="text" class="form-control" th:field="*{timeZone}" placeholder="America/Bogota"/>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Foto principal (URL)</label>
                            <input type="url" class="form-control" th:field="*{mainPhotoUrl}" placeholder="https://..."/>
                        </div>
                    </div>

                    <hr/>

                    <div class="mb-3">
                        <label class="form-label">Métodos de pago</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" th:field="*{allowOnsitePayment}" id="onsite"/>
                            <label class="form-check-label" for="onsite">Pago en cancha</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" th:field="*{allowBankTransfer}" id="bank"/>
                            <label class="form-check-label" for="bank">Transferencia bancaria</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" th:field="*{allowOnlinePayment}" id="online"/>
                            <label class="form-check-label" for="online">Pago online</label>
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Latitud</label>
                            <input type="number" step="any" class="form-control" th:field="*{lat}" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Longitud</label>
                            <input type="number" step="any" class="form-control" th:field="*{lng}" />
                        </div>
                    </div>

                    <div class="mt-4 d-flex justify-content-between align-items-center">
                        <a th:href="@{/dashboard/owner/venues(ownerId=${ownerId})}" class="btn btn-outline-secondary">Cancelar</a>
                        <button type="submit" id="submitBtn" class="btn btn-primary">
                            <span id="submitText">Crear Complejo</span>
                            <span id="spinner" class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
                        </button>
                    </div>
                </form>

                <!-- Success block + manual button + auto redirect -->
                <div th:if="${success}" class="mt-3">
                    <div class="alert alert-success d-flex justify-content-between align-items-center">
                        <span th:text="${success}"></span>
                        <a th:href="@{/dashboard/owner(ownerId=${ownerId})}" class="btn btn-sm btn-success ms-3">Ir al Dashboard</a>
                    </div>

                    <script th:inline="javascript">
                        /*<![CDATA[*/
                        setTimeout(function() {
                            window.location.href = /*[[@{/dashboard/owner(ownerId=${ownerId})}]]*/ '/dashboard/owner?ownerId=[[${ownerId}]]';
                        }, 1500);
                        /*]]>*/
                    </script>
                </div>

                <div class="mt-3 text-muted small">
                    Consejo: completa los campos y espera a la redirección a la lista; el form se limpia tras el redirect.
                </div>

            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    (function(){
        const form = document.getElementById('venueForm');
        const btn = document.getElementById('submitBtn');
        const spinner = document.getElementById('spinner');
        const submitText = document.getElementById('submitText');

        form.addEventListener('submit', function (e) {
            if (!form.checkValidity()) {
                form.classList.add('was-validated');
                return;
            }
            btn.setAttribute('disabled', 'disabled');
            spinner.classList.remove('d-none');
            submitText.textContent = 'Creando...';
        });

        const firstInput = form.querySelector('input[th\\:field], input[name="name"], input[0]');
        if (firstInput) firstInput.focus();
    })();
</script>
</body>
</html>
